import{D as B}from"./chunk-YRY2CZ6I-DPlVjh6U.js";import{g as I}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{S as E}from"./chunk-D7H6ZNK4-BW0T2JhD.js";import{K as F}from"./chunk-6HTZNHPT-edTwFg32.js";import{b as l,u as T}from"./chunk-4TC5YS65-Cb_suZcW.js";import{U as S,b as g,dB as V,j as e,H as w,aa as N,o as j,dw as L,r as P,v as s,I as D,E as M,B as v,ad as R,a4 as z,a7 as x,ah as H,a5 as K,a6 as y}from"./index-7F_IjDe6.js";import{T as U}from"./Trans-BhgfXYrZ.js";import{R as i}from"./radio-group-BmX7Y9Gb.js";import{C as W}from"./currency-input-BHVE2Enp.js";import"./index.esm-dHBu74Xj.js";import"./prompt-D8bgNQm2.js";import"./index-Cc5fa2Ve.js";var k=z({is_automatic:y().toLowerCase(),code:y().min(1),is_tax_inclusive:K().optional(),status:x(["active","inactive","draft"]),value_type:x(["fixed","percentage"]),value:H(),allocation:x(["each","across"])}),A=({promotion:r})=>{const{t:o}=g(),{handleSuccess:c}=T(),a=N({defaultValues:{is_automatic:r.is_automatic.toString(),is_tax_inclusive:r.is_tax_inclusive,code:r.code,status:r.status,value:r.application_method.value,allocation:r.application_method.allocation,value_type:r.application_method.type},resolver:R(k)}),m=j({control:a.control,name:"value_type"})==="fixed",{mutateAsync:_,isPending:b}=L(r.id),C=a.handleSubmit(async t=>{await _({is_automatic:t.is_automatic==="true",code:t.code,status:t.status,is_tax_inclusive:t.is_tax_inclusive,application_method:{value:t.value,type:t.value_type,allocation:t.allocation}},{onSuccess:()=>{c()}})}),u=j({control:a.control,name:"value_type"});return P.useEffect(()=>{u==="fixed"&&r.type==="standard"||a.setValue("is_tax_inclusive",!1)},[u,a,r]),e.jsx(l.Form,{form:a,children:e.jsxs(F,{onSubmit:C,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(l.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(s.Field,{control:a.control,name:"status",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("promotions.form.status.label")}),e.jsx(s.Control,{children:e.jsxs(i,{className:"flex-col gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(i.ChoiceBox,{value:"draft",label:o("promotions.form.status.draft.title"),description:o("promotions.form.status.draft.description")}),e.jsx(i.ChoiceBox,{value:"active",label:o("promotions.form.status.active.title"),description:o("promotions.form.status.active.description")}),e.jsx(i.ChoiceBox,{value:"inactive",label:o("promotions.form.status.inactive.title"),description:o("promotions.form.status.inactive.description")})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"is_automatic",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("promotions.form.method.label")}),e.jsx(s.Control,{children:e.jsxs(i,{className:"flex-col gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(i.ChoiceBox,{value:"false",label:o("promotions.form.method.code.title"),description:o("promotions.form.method.code.description")}),e.jsx(i.ChoiceBox,{value:"true",label:o("promotions.form.method.automatic.title"),description:o("promotions.form.method.automatic.description")})]})}),e.jsx(s.ErrorMessage,{})]})}),u==="fixed"&&r.type==="standard"&&e.jsx(E,{control:a.control,name:"is_tax_inclusive",label:o("promotions.form.taxInclusive.title"),description:o("promotions.form.taxInclusive.description")}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:a.control,name:"code",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("promotions.form.code.title")}),e.jsx(s.Control,{children:e.jsx(D,{...t})})]})}),e.jsx(M,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(U,{t:o,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]}),e.jsx(s.Field,{control:a.control,name:"value_type",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("promotions.fields.value_type")}),e.jsx(s.Control,{children:e.jsxs(i,{className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(i.ChoiceBox,{value:"fixed",label:o("promotions.form.value_type.fixed.title"),description:o("promotions.form.value_type.fixed.description")}),e.jsx(i.ChoiceBox,{value:"percentage",label:o("promotions.form.value_type.percentage.title"),description:o("promotions.form.value_type.percentage.description")})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"value",render:({field:{onChange:t,...d}})=>{var f;const h=((f=r.application_method)==null?void 0:f.currency_code)??"USD";return e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o(m?"fields.amount":"fields.percentage")}),e.jsx(s.Control,{children:m?e.jsx(W,{min:0,onValueChange:n=>t(n?parseInt(n):null),code:h,symbol:I(h),...d,value:d.value}):e.jsx(B,{min:0,max:100,...d,value:d.value||"",onChange:n=>{t(n.target.value===""?null:parseInt(n.target.value))}},"amount")}),e.jsx(s.ErrorMessage,{})]})}}),e.jsx(s.Field,{control:a.control,name:"allocation",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("promotions.fields.allocation")}),e.jsx(s.Control,{children:e.jsxs(i,{className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(i.ChoiceBox,{value:"each",label:o("promotions.form.allocation.each.title"),description:o("promotions.form.allocation.each.description")}),e.jsx(i.ChoiceBox,{value:"across",label:o("promotions.form.allocation.across.title"),description:o("promotions.form.allocation.across.description")})]})}),e.jsx(s.ErrorMessage,{})]})})]})}),e.jsx(l.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(l.Close,{asChild:!0,children:e.jsx(v,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(v,{size:"small",type:"submit",isLoading:b,children:o("actions.save")})]})})]})})},te=()=>{const{id:r}=S(),{t:o}=g(),{promotion:c,isLoading:a,isError:p,error:m}=V(r);if(p)throw m;return e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsx(w,{children:o("promotions.edit.title")})}),!a&&c&&e.jsx(A,{promotion:c})]})};export{te as Component};
